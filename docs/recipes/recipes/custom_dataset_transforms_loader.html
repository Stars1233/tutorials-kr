
<!DOCTYPE html>


<html lang="ko" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="article:modified_time" content="2022-11-30T07:09:41+00:00" /><meta property="og:title" content="사용자 정의 PyTorch Dataloader 작성하기" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tutorials.pytorch.kr/recipes/recipes/custom_dataset_transforms_loader.html" />
<meta property="og:site_name" content="PyTorch Tutorials KR" />
<meta property="og:description" content="머신러닝 알고리즘을 개발하기 위해서는 데이터 전처리에 많은 노력이 필요합니다. PyTorch는 데이터를 로드하는데 쉽고 가능하다면 더 좋은 가독성을 가진 코드를 만들기위해 많은 도구들을 제공합니다. 이 레시피에서는 다음 세 가지를 배울 수 있습니다. PyTorch 데이터셋 API들을 이용하여 사용자 정의 데이터셋 만들기., 구성가능하며 호출 될 수 있는 사용자 정의 transform 만들기., 이러한 컴포넌트들을 합쳐서 사용자 정의 dataloader 만들기.. 이 튜토리얼을 실행하기 위해서는 다음의 패키지들이 설치 되었는지 ..." />
<meta property="og:image" content="https://tutorials.pytorch.kr/_static/logos/logo-kr-sm-dark.png" />
<meta property="og:image:alt" content="PyTorch Tutorials KR" />
<meta name="description" content="머신러닝 알고리즘을 개발하기 위해서는 데이터 전처리에 많은 노력이 필요합니다. PyTorch는 데이터를 로드하는데 쉽고 가능하다면 더 좋은 가독성을 가진 코드를 만들기위해 많은 도구들을 제공합니다. 이 레시피에서는 다음 세 가지를 배울 수 있습니다. PyTorch 데이터셋 API들을 이용하여 사용자 정의 데이터셋 만들기., 구성가능하며 호출 될 수 있는 사용자 정의 transform 만들기., 이러한 컴포넌트들을 합쳐서 사용자 정의 dataloader 만들기.. 이 튜토리얼을 실행하기 위해서는 다음의 패키지들이 설치 되었는지 ..." />
<meta property="og:ignore_canonical" content="true" />

    <title>사용자 정의 PyTorch Dataloader 작성하기 &#8212; 파이토치 한국어 튜토리얼 (PyTorch tutorials in Korean)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=536c50fe" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=4d2595e5" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/pytorch_theme.css?v=c326296f" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=097efa9c" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom2.css?v=b169ea90" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=725a5b95"></script>
    <script src="../../_static/doctools.js?v=92e14aea"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/translations.js?v=b5f768d8"></script>
    <script src="../../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../../_static/katex_autorenderer.js?v=bebc588a"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'recipes/recipes/custom_dataset_transforms_loader';</script>
    <link rel="canonical" href="https://tutorials.pytorch.kr/recipes/recipes/custom_dataset_transforms_loader.html" />
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="색인" href="../../genindex.html" />
    <link rel="search" title="검색" href="../../search.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ko"/>
    <meta name="docbuild:last-update" content="2022년 11월 30일"/>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>
<script>
  if (window.location.hostname === 'docs.pytorch.org' || window.location.hostname === 'docs-preview.pytorch.org') {
    const script = document.createElement('script');
    script.src = 'https://cmp.osano.com/16A0DbT9yDNIaQkvZ/31b1b91a-e0b6-47ea-bde2-7f2bd13dbe5c/osano.js?variant=one';
    document.head.appendChild(script);
  }
</script>
<script>
  // Cookie banner for non-LF projects
  document.addEventListener('DOMContentLoaded', function () {
    // Hide cookie banner on local environments and LF owned docs
    if (window.location.hostname === 'localhost' ||
      window.location.hostname === '0.0.0.0' ||
      window.location.hostname === '127.0.0.1' ||
      window.location.hostname === 'docs.pytorch.org' ||
      window.location.hostname === 'docs-preview.pytorch.org' ||
      window.location.hostname.startsWith('192.168.')) {
      const banner = document.querySelector('.cookie-banner-wrapper');
      if (banner) {
        banner.style.display = 'none';
      }
    }
  });
</script>
<!-- Conditional CSS for header and footer height adjustment -->

<link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" crossorigin="anonymous">
<script type="text/javascript" src="../../_static/js/theme.js"></script>
<script type="text/javascript" src="../../_static/js/dropdown-menu.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Gothic+Coding:wght@400;700&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">
<meta property="og:image" content="../../_static/img/pytorch_seo.png" />
<link rel="stylesheet" href="../../_static/webfonts/all.min.css" crossorigin="anonymous">
<meta http-equiv="Content-Security-Policy"
  content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval' blob:;">
<meta name="pytorch_project" content="tutorials">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-LZRD6GXDLF" height="0" width="0"
    style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<!-- Google Tag Manager -->
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || []; w[l].push({
      'gtm.start':
        new Date().getTime(), event: 'gtm.js'
    }); var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    j.onload = function () {
      window.dispatchEvent(new Event('gtm_loaded'));
      console.log('GTM loaded successfully');
    };
  })(window, document, 'script', 'dataLayer', 'G-LZRD6GXDLF');
</script>
<!-- End Google Tag Manager -->
<!-- Facebook Pixel Code -->
<script>
  !function (f, b, e, v, n, t, s) {
    if (f.fbq) return; n = f.fbq = function () {
      n.callMethod ?
        n.callMethod.apply(n, arguments) : n.queue.push(arguments)
    };
    if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
    n.queue = []; t = b.createElement(e); t.async = !0;
    t.src = v; s = b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t, s)
  }(window, document, 'script',
    'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '243028289693773');
  fbq('track', 'PageView');
</script>
<script>
  document.documentElement.setAttribute('data-version', 'v2.8.0+cu128');
</script>
<noscript>
  <img height="1" width="1" src="https://www.facebook.com/tr?id=243028289693773&ev=PageView&noscript=1" />
</noscript>
<script>
  function gtag() {
    window.dataLayer.push(arguments);
  }
</script>
<!-- End Facebook Pixel Code -->
<!-- Script to Fix scrolling -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Fix anchor scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          const headerHeight =
            (document.querySelector('.header-holder') ? document.querySelector('.header-holder').offsetHeight : 0) +
            (document.querySelector('.bd-header') ? document.querySelector('.bd-header').offsetHeight : 0) + 20;

          const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - headerHeight;
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
          });

          // Update URL hash without scrolling
          history.pushState(null, null, '#' + targetId);
        }
      });
    });
  });
</script>

<script async src="https://cse.google.com/cse.js?cx=e65585f8c3ea1440e"></script>


  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ko"/>
    <meta name="docbuild:last-update" content="2022년 11월 30일"/>

  </head>

<body data-feedback-url="https://github.com/PyTorchKorea/tutorials-kr" class="pytorch-body">
  
    <div class="container-fluid header-holder tutorials-header" id="header-holder">
   <div class="header-container-wrapper">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.kr/" aria-label="PyTorchKR"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="learnDropdownButton" data-toggle="learn-dropdown" class="learn-dropdown">
              <a class="with-down-arrow">
                <span>배우기</span>
              </a>
              <div class="learn-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.kr/get-started/locally/">
                  <span class="dropdown-title">PyTorch 시작하기</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/beginner/basics/intro.html">
                  <span class="dropdown-title">기본 익히기</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 튜토리얼</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/hub/">
                  <span class="dropdown-title">한국어 모델 허브</span>
                </a>
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/tutorials/" target="_blank">
                  <span class="dropdown-title">Official Tutorials</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <a href="https://pytorch.kr/blog/">
              <span>블로그</span>
            </a>
          </li>

          <li class="main-menu-item">
          <div id="docsDropdownButton" data-toggle="docs-dropdown" class="docs-dropdown">
              <a class="with-down-arrow">
              <span>문서</span>
              </a>
              <div class="docs-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/docs/" target="_blank">
                  <span class="dropdown-title">PyTorch API</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/domains/">
                  <span class="dropdown-title">Domain API 소개</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 튜토리얼</span>
                </a>
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/tutorials/" target="_blank">
                  <span class="dropdown-title">Official Tutorials</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
          <div id="communityDropdownButton" data-toggle="community-dropdown" class="community-dropdown">
              <a class="with-down-arrow">
              <span>커뮤니티</span>
              </a>
              <div class="community-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://discuss.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 커뮤니티</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/resources/">
                  <span class="dropdown-title">개발자 정보</span>
                </a>
                <a class="nav-dropdown-item" href="https://landscape.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Landscape</span>
                </a>
              </div>
            </div>
          </li>

        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu">
        <i class="fa-solid fa-ellipsis"></i>
      </a>
    </div>
  </div>
 </div>

 <!-- Begin Mobile Menu -->

<div class="mobile-main-menu">
  <div class="container-fluid">
    <div class="header-container-wrapper">
      <div class="mobile-main-menu-header-container">
        <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu">
          <i class="fa-solid fa-xmark"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="mobile-main-menu-links-container">
    <div class="main-menu">
      <ul>
         <li class="resources-mobile-menu-title">
           <a>배우기</a>
         </li>
         <ul class="resources-mobile-menu-items">
           <li>
             <a href="https://pytorch.kr/get-started/locally/">PyTorch 시작하기</a>
           </li>
           <li>
             <a href="https://tutorials.pytorch.kr/beginner/basics/intro.html">기본 익히기</a>
           </li>
           <li>
             <a href="https://tutorials.pytorch.kr/">한국어 튜토리얼</a>
           </li>
           <li>
             <a href="https://pytorch.kr/hub/">한국어 모델 허브</a>
           </li>
           <li>
             <a href="https://docs.pytorch.org/tutorials/" target="_blank">Official Tutorials</a>
           </li>
        </ul>
         <li class="resources-mobile-menu-title">
           <a href="https://pytorch.kr/blog/">블로그</a>
         </li>
         <li class="resources-mobile-menu-title">
           <a>문서</a>
         </li>
         <ul class="resources-mobile-menu-items">
          <li>
            <a href="https://docs.pytorch.org/docs/" target="_blank">PyTorch API</a>
          </li>
          <li>
            <a href="https://pytorch.kr/domains/">Domain API 소개</a>
          </li>
          <li>
            <a href="https://tutorials.pytorch.kr/">한국어 튜토리얼</a>
          </li>
          <li>
            <a href="https://docs.pytorch.org/tutorials/" target="_blank">Official Tutorials</a>
          </li>
        </ul>
        <li class="resources-mobile-menu-title">
          <a>커뮤니티</a>
        </li>
         <ul class="resources-mobile-menu-items">
          <li>
            <a href="https://discuss.pytorch.kr/">한국어 커뮤니티</a>
          </li>
          <li>
            <a href="https://pytorch.kr/resources/">개발자 정보</a>
          </li>
          <li>
            <a href="https://landscape.pytorch.org/" target="_blank">Landscape</a>
          </li>
        </ul>
      </ul>
    </div>
  </div>
</div>

<!-- End Mobile Menu -->
  
  
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">
  <a href="../../index.html" class="version">v2.8.0+cu128</a>
</div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../intro.html">
    Intro
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../compilers_index.html">
    Compilers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../domains.html">
    Domains
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../distributed.html">
    Distributed
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../deep-dive.html">
    Deep Dive
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../extension.html">
    Extension
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../ecosystem.html">
    Ecosystem
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../recipes_index.html">
    Recipes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<div class="search-container-wrapper">
  <div id="sphinx-search" class="search-container">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </div>

  <div id="google-search" class="search-container" style="display:none;">
    <div class="gcse-search-wrapper">
      <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
      <div class="gcse-search"></div>
    </div>
  </div>

  <div class="search-toggle-container" data-bs-title="Google Search Off" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <div class="search-toggle-inner">
      <label class="switch">
        <input type="checkbox" id="search-toggle">
        <span class="slider round"></span>
      </label>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  // Define the search callback
  const myWebSearchStartingCallback = (gname, query) => {
    if (typeof dataLayer !== 'undefined' && query) {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'google_search',
        'search_term': query,
        'event_category': 'Search',
        'event_label': 'Google Search'
      });
    }
    return '';
  };

  // Set up the GCSE search callbacks
  window.__gcse || (window.__gcse = {});
  window.__gcse.searchCallbacks = {
    web: { starting: myWebSearchStartingCallback }
  };

  if (window.location.pathname.includes('/search.html')) {
    document.body.classList.add('search-page');
  }

  // Function to reinitialize Google CSE
  function reinitializeGoogleSearch() {
    if (window.__gcse && window.__gcse.initializationCallback) {
      window.__gcse.initializationCallback();
    }
  }

  // Function to handle search toggle
  function handleSearchToggle(toggle, sphinxSearch, googleSearch) {
    if (!toggle || !sphinxSearch || !googleSearch) return;

    // Check if the URL contains /stable/ or /tutorials/
    const currentUrl = window.location.href;
    // TODO: We've had reports that the google programmable search is returning stale documentation,
    //       Simple reproduction is to turn google search on and search for multinomial which will
    //       result in returning 1.8.1 documentation.
    //       We should turn this back on when we resolve that bug.
    const shouldDefaultToGoogle = false;
    const savedPreference = localStorage.getItem('searchPreference');

    // Set initial state
    if (savedPreference === 'google' || (savedPreference === null && shouldDefaultToGoogle)) {
      toggle.checked = true;
      sphinxSearch.style.display = 'none';
      googleSearch.style.display = 'block';
      if (savedPreference === null) {
        localStorage.setItem('searchPreference', 'google');
      }
      reinitializeGoogleSearch();
    } else {
      toggle.checked = false;
      sphinxSearch.style.display = 'block';
      googleSearch.style.display = 'none';
    }

    // Update tooltip
    updateTooltip(toggle.checked);

    // Skip if already initialized
    if (toggle.hasAttribute('data-initialized')) return;
    toggle.setAttribute('data-initialized', 'true');

    toggle.addEventListener('change', function() {
      if (this.checked) {
        sphinxSearch.style.display = 'none';
        googleSearch.style.display = 'block';
        localStorage.setItem('searchPreference', 'google');
        reinitializeGoogleSearch();
        trackSearchEngineSwitch('Google');
      } else {
        sphinxSearch.style.display = 'block';
        googleSearch.style.display = 'none';
        localStorage.setItem('searchPreference', 'sphinx');
        trackSearchEngineSwitch('Sphinx');
      }

      updateTooltip(this.checked);
      updateMobileSearch();
    });
  }

  // Update tooltip based on toggle state
  function updateTooltip(isChecked) {
    const tooltipElement = document.querySelector('.search-toggle-container');
    if (!tooltipElement) return;

    tooltipElement.setAttribute('data-bs-title', isChecked ? 'Google Search On' : 'Google Search Off');

    if (bootstrap && bootstrap.Tooltip) {
      const tooltipInstance = bootstrap.Tooltip.getInstance(tooltipElement);
      if (tooltipInstance) tooltipInstance.dispose();
      new bootstrap.Tooltip(tooltipElement);
    }
  }

  // Track search engine switch
  function trackSearchEngineSwitch(engine) {
    if (typeof dataLayer !== 'undefined') {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'search_engine_switch',
        'event_category': 'Search',
        'event_label': engine
      });
    }
  }

  // Function to update mobile search based on current toggle state
  function updateMobileSearch() {
    const toggle = document.getElementById('search-toggle');
    if (!toggle) return;

    const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
    if (!mobileSearchContainer) return;

    const mobileSphinxSearch = mobileSearchContainer.querySelector('#sphinx-search');
    const mobileGoogleSearch = mobileSearchContainer.querySelector('#google-search');

    if (mobileSphinxSearch && mobileGoogleSearch) {
      mobileSphinxSearch.style.display = toggle.checked ? 'none' : 'block';
      mobileGoogleSearch.style.display = toggle.checked ? 'block' : 'none';

      if (toggle.checked) {
        reinitializeGoogleSearch();
      }
    }
  }

  // Initialize desktop search toggle
  const toggle = document.getElementById('search-toggle');
  const sphinxSearch = document.getElementById('sphinx-search');
  const googleSearch = document.getElementById('google-search');
  handleSearchToggle(toggle, sphinxSearch, googleSearch);

  // Set placeholder text for Google search input
  const observer = new MutationObserver(function() {
    document.querySelectorAll('.gsc-input input').forEach(input => {
      if (input && !input.hasAttribute('data-placeholder-set')) {
        input.setAttribute('placeholder', 'Search the docs ...');
        input.setAttribute('data-placeholder-set', 'true');
      }
    });
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Fix for scroll jump issue - improved approach
  function setupSearchInputHandlers(input) {
    if (input.hasAttribute('data-scroll-fixed')) return;
    input.setAttribute('data-scroll-fixed', 'true');

    let lastScrollPosition = 0;
    let isTyping = false;
    let scrollTimeout;

    // Save position before typing starts
    input.addEventListener('keydown', () => {
      lastScrollPosition = window.scrollY;
      isTyping = true;

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);
    });

    // Only maintain scroll position during typing
    function maintainScroll() {
      if (document.activeElement === input && isTyping) {
        window.scrollTo(0, lastScrollPosition);
        requestAnimationFrame(maintainScroll);
      }
    }

    input.addEventListener('focus', () => {
      // Just store initial position but don't force it
      lastScrollPosition = window.scrollY;
    });

    input.addEventListener('input', () => {
      isTyping = true;
      window.scrollTo(0, lastScrollPosition);

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);

      requestAnimationFrame(maintainScroll);
    });
  }

  // Apply to all search inputs and observe for new ones
  function applyToSearchInputs() {
    document.querySelectorAll('.search-container input, .gsc-input input').forEach(setupSearchInputHandlers);
  }

  applyToSearchInputs();

  const searchObserver = new MutationObserver(applyToSearchInputs);
  searchObserver.observe(document.body, { childList: true, subtree: true });

  // Watch for mobile menu creation
  const mobileMenuObserver = new MutationObserver(function(mutations) {
    for (const mutation of mutations) {
      if (!mutation.addedNodes.length) continue;

      // Style mobile search inputs
      document.querySelectorAll('.sidebar-header-items__end .navbar-item .search-container-wrapper .gsc-input input').forEach(input => {
        if (input) {
          input.setAttribute('placeholder', 'Search the docs ...');
          input.style.paddingLeft = '36px';
        }
      });

      // Check for mobile search container
      const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
      if (!mobileSearchContainer) continue;

      const mobileToggle = mobileSearchContainer.querySelector('#search-toggle');
      if (mobileToggle && toggle) {
        // Sync mobile toggle with desktop toggle
        mobileToggle.checked = toggle.checked;
        updateMobileSearch();

        // Add event listener to mobile toggle if not already added
        if (!mobileToggle.hasAttribute('data-initialized')) {
          mobileToggle.setAttribute('data-initialized', 'true');
          mobileToggle.addEventListener('change', function() {
            // Sync desktop toggle with mobile toggle
            toggle.checked = this.checked;
            // Trigger change event on desktop toggle to update both
            toggle.dispatchEvent(new Event('change'));
          });
        }
      }
    }
  });

  mobileMenuObserver.observe(document.body, { childList: true, subtree: true });

  // Ensure Google CSE is properly loaded
  if (window.__gcse) {
    window.__gcse.callback = function() {
      // This will run after Google CSE is fully loaded
      if (toggle && toggle.checked) {
        reinitializeGoogleSearch();
      }
    };
  } else {
    window.__gcse = {
      callback: function() {
        if (toggle && toggle.checked) {
          reinitializeGoogleSearch();
        }
      }
    };
  }
});
</script>
</div>
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PyTorchKorea/tutorials-kr" title="한국어 튜토리얼 GitHub 저장소" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">한국어 튜토리얼 GitHub 저장소</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discuss.pytorch.kr/" title="파이토치 한국어 커뮤니티" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">파이토치 한국어 커뮤니티</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../intro.html">
    Intro
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../compilers_index.html">
    Compilers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../domains.html">
    Domains
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../distributed.html">
    Distributed
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../deep-dive.html">
    Deep Dive
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../extension.html">
    Extension
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../ecosystem.html">
    Ecosystem
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../recipes_index.html">
    Recipes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="search-container-wrapper">
  <div id="sphinx-search" class="search-container">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </div>

  <div id="google-search" class="search-container" style="display:none;">
    <div class="gcse-search-wrapper">
      <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
      <div class="gcse-search"></div>
    </div>
  </div>

  <div class="search-toggle-container" data-bs-title="Google Search Off" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <div class="search-toggle-inner">
      <label class="switch">
        <input type="checkbox" id="search-toggle">
        <span class="slider round"></span>
      </label>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  // Define the search callback
  const myWebSearchStartingCallback = (gname, query) => {
    if (typeof dataLayer !== 'undefined' && query) {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'google_search',
        'search_term': query,
        'event_category': 'Search',
        'event_label': 'Google Search'
      });
    }
    return '';
  };

  // Set up the GCSE search callbacks
  window.__gcse || (window.__gcse = {});
  window.__gcse.searchCallbacks = {
    web: { starting: myWebSearchStartingCallback }
  };

  if (window.location.pathname.includes('/search.html')) {
    document.body.classList.add('search-page');
  }

  // Function to reinitialize Google CSE
  function reinitializeGoogleSearch() {
    if (window.__gcse && window.__gcse.initializationCallback) {
      window.__gcse.initializationCallback();
    }
  }

  // Function to handle search toggle
  function handleSearchToggle(toggle, sphinxSearch, googleSearch) {
    if (!toggle || !sphinxSearch || !googleSearch) return;

    // Check if the URL contains /stable/ or /tutorials/
    const currentUrl = window.location.href;
    // TODO: We've had reports that the google programmable search is returning stale documentation,
    //       Simple reproduction is to turn google search on and search for multinomial which will
    //       result in returning 1.8.1 documentation.
    //       We should turn this back on when we resolve that bug.
    const shouldDefaultToGoogle = false;
    const savedPreference = localStorage.getItem('searchPreference');

    // Set initial state
    if (savedPreference === 'google' || (savedPreference === null && shouldDefaultToGoogle)) {
      toggle.checked = true;
      sphinxSearch.style.display = 'none';
      googleSearch.style.display = 'block';
      if (savedPreference === null) {
        localStorage.setItem('searchPreference', 'google');
      }
      reinitializeGoogleSearch();
    } else {
      toggle.checked = false;
      sphinxSearch.style.display = 'block';
      googleSearch.style.display = 'none';
    }

    // Update tooltip
    updateTooltip(toggle.checked);

    // Skip if already initialized
    if (toggle.hasAttribute('data-initialized')) return;
    toggle.setAttribute('data-initialized', 'true');

    toggle.addEventListener('change', function() {
      if (this.checked) {
        sphinxSearch.style.display = 'none';
        googleSearch.style.display = 'block';
        localStorage.setItem('searchPreference', 'google');
        reinitializeGoogleSearch();
        trackSearchEngineSwitch('Google');
      } else {
        sphinxSearch.style.display = 'block';
        googleSearch.style.display = 'none';
        localStorage.setItem('searchPreference', 'sphinx');
        trackSearchEngineSwitch('Sphinx');
      }

      updateTooltip(this.checked);
      updateMobileSearch();
    });
  }

  // Update tooltip based on toggle state
  function updateTooltip(isChecked) {
    const tooltipElement = document.querySelector('.search-toggle-container');
    if (!tooltipElement) return;

    tooltipElement.setAttribute('data-bs-title', isChecked ? 'Google Search On' : 'Google Search Off');

    if (bootstrap && bootstrap.Tooltip) {
      const tooltipInstance = bootstrap.Tooltip.getInstance(tooltipElement);
      if (tooltipInstance) tooltipInstance.dispose();
      new bootstrap.Tooltip(tooltipElement);
    }
  }

  // Track search engine switch
  function trackSearchEngineSwitch(engine) {
    if (typeof dataLayer !== 'undefined') {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'search_engine_switch',
        'event_category': 'Search',
        'event_label': engine
      });
    }
  }

  // Function to update mobile search based on current toggle state
  function updateMobileSearch() {
    const toggle = document.getElementById('search-toggle');
    if (!toggle) return;

    const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
    if (!mobileSearchContainer) return;

    const mobileSphinxSearch = mobileSearchContainer.querySelector('#sphinx-search');
    const mobileGoogleSearch = mobileSearchContainer.querySelector('#google-search');

    if (mobileSphinxSearch && mobileGoogleSearch) {
      mobileSphinxSearch.style.display = toggle.checked ? 'none' : 'block';
      mobileGoogleSearch.style.display = toggle.checked ? 'block' : 'none';

      if (toggle.checked) {
        reinitializeGoogleSearch();
      }
    }
  }

  // Initialize desktop search toggle
  const toggle = document.getElementById('search-toggle');
  const sphinxSearch = document.getElementById('sphinx-search');
  const googleSearch = document.getElementById('google-search');
  handleSearchToggle(toggle, sphinxSearch, googleSearch);

  // Set placeholder text for Google search input
  const observer = new MutationObserver(function() {
    document.querySelectorAll('.gsc-input input').forEach(input => {
      if (input && !input.hasAttribute('data-placeholder-set')) {
        input.setAttribute('placeholder', 'Search the docs ...');
        input.setAttribute('data-placeholder-set', 'true');
      }
    });
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Fix for scroll jump issue - improved approach
  function setupSearchInputHandlers(input) {
    if (input.hasAttribute('data-scroll-fixed')) return;
    input.setAttribute('data-scroll-fixed', 'true');

    let lastScrollPosition = 0;
    let isTyping = false;
    let scrollTimeout;

    // Save position before typing starts
    input.addEventListener('keydown', () => {
      lastScrollPosition = window.scrollY;
      isTyping = true;

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);
    });

    // Only maintain scroll position during typing
    function maintainScroll() {
      if (document.activeElement === input && isTyping) {
        window.scrollTo(0, lastScrollPosition);
        requestAnimationFrame(maintainScroll);
      }
    }

    input.addEventListener('focus', () => {
      // Just store initial position but don't force it
      lastScrollPosition = window.scrollY;
    });

    input.addEventListener('input', () => {
      isTyping = true;
      window.scrollTo(0, lastScrollPosition);

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);

      requestAnimationFrame(maintainScroll);
    });
  }

  // Apply to all search inputs and observe for new ones
  function applyToSearchInputs() {
    document.querySelectorAll('.search-container input, .gsc-input input').forEach(setupSearchInputHandlers);
  }

  applyToSearchInputs();

  const searchObserver = new MutationObserver(applyToSearchInputs);
  searchObserver.observe(document.body, { childList: true, subtree: true });

  // Watch for mobile menu creation
  const mobileMenuObserver = new MutationObserver(function(mutations) {
    for (const mutation of mutations) {
      if (!mutation.addedNodes.length) continue;

      // Style mobile search inputs
      document.querySelectorAll('.sidebar-header-items__end .navbar-item .search-container-wrapper .gsc-input input').forEach(input => {
        if (input) {
          input.setAttribute('placeholder', 'Search the docs ...');
          input.style.paddingLeft = '36px';
        }
      });

      // Check for mobile search container
      const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
      if (!mobileSearchContainer) continue;

      const mobileToggle = mobileSearchContainer.querySelector('#search-toggle');
      if (mobileToggle && toggle) {
        // Sync mobile toggle with desktop toggle
        mobileToggle.checked = toggle.checked;
        updateMobileSearch();

        // Add event listener to mobile toggle if not already added
        if (!mobileToggle.hasAttribute('data-initialized')) {
          mobileToggle.setAttribute('data-initialized', 'true');
          mobileToggle.addEventListener('change', function() {
            // Sync desktop toggle with mobile toggle
            toggle.checked = this.checked;
            // Trigger change event on desktop toggle to update both
            toggle.dispatchEvent(new Event('change'));
          });
        }
      }
    }
  });

  mobileMenuObserver.observe(document.body, { childList: true, subtree: true });

  // Ensure Google CSE is properly loaded
  if (window.__gcse) {
    window.__gcse.callback = function() {
      // This will run after Google CSE is fully loaded
      if (toggle && toggle.checked) {
        reinitializeGoogleSearch();
      }
    };
  } else {
    window.__gcse = {
      callback: function() {
        if (toggle && toggle.checked) {
          reinitializeGoogleSearch();
        }
      }
    };
  }
});
</script>
</div>
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PyTorchKorea/tutorials-kr" title="한국어 튜토리얼 GitHub 저장소" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">한국어 튜토리얼 GitHub 저장소</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discuss.pytorch.kr/" title="파이토치 한국어 커뮤니티" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">파이토치 한국어 커뮤니티</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">사용자 정의...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">
<div class="rating">
    Rate this Page
    <div class="stars">
        
        <span class="star" data-behavior="tutorial-rating" data-count="1" data-value="1">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="2" data-value="2">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="3" data-value="3">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="4" data-value="4">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="5" data-value="5">★</span>
        
    </div>
</div>
</div>
      
    </div>
  
</div>
</div>
              
              
  
<div id="searchbox"></div>
  <article class="bd-article" id="pytorch-article">
    <!-- Hidden breadcrumb schema for SEO only -->
    <div style="display:none;" itemscope itemtype="https://schema.org/BreadcrumbList">
      
      <div itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <meta itemprop="name" content="사용자 정의 PyTorch Dataloader 작성하기">
        <meta itemprop="position" content="1">
      </div>
    </div>

    
    <script>
      if ((window.location.href.indexOf("/unstable/") != -1) && (window.location.href.indexOf("/unstable/unstable_index") < 1)) {
        var div = '<div class="prototype-banner"><i class="fa fa-flask" aria-hidden="true"></i> <strong>Unstable feature:</strong> Not typically available in binary distributions like PyPI. Early stage for feedback and testing.</div>'
        document.addEventListener('DOMContentLoaded', function () {
          document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div);
        });
      }
    </script>
    
    
    <div class="pytorch-call-to-action-links">
      <div id="tutorial-type">recipes/recipes/custom_dataset_transforms_loader</div>
      <a id="colab-link" data-behavior="call-to-action-event" data-response="Run in Google Colab" target="_blank">
        <div id="google-colab-link">
          <img class="call-to-action-img" src="../../_static/img/pytorch-colab.svg" />
          <div class="call-to-action-desktop-view">Run in Google Colab</div>
          <div class="call-to-action-mobile-view">Colab</div>
        </div>
      </a>
      <a id="notebook-link" data-behavior="call-to-action-event" data-response="Download Notebook">
        <div id="download-notebook-link">
          <img class="call-to-action-notebook-img" src="../../_static/img/pytorch-download.svg" />
          <div class="call-to-action-desktop-view">Download Notebook</div>
          <div class="call-to-action-mobile-view">Notebook</div>
        </div>
      </a>
      <a id="github-link" data-behavior="call-to-action-event" data-response="View on Github" target="_blank">
        <div id="github-view-link">
          <img class="call-to-action-img" src="../../_static/img/pytorch-github.svg" />
          <div class="call-to-action-desktop-view">View on GitHub</div>
          <div class="call-to-action-mobile-view">GitHub</div>
        </div>
      </a>
    </div>
    

    
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">참고</p>
<p><a class="reference internal" href="#sphx-glr-download-recipes-recipes-custom-dataset-transforms-loader-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="pytorch-dataloader">
<span id="sphx-glr-recipes-recipes-custom-dataset-transforms-loader-py"></span><h1>사용자 정의 PyTorch Dataloader 작성하기<a class="headerlink" href="#pytorch-dataloader" title="Link to this heading">#</a></h1>
<p>머신러닝 알고리즘을 개발하기 위해서는 데이터 전처리에 많은 노력이 필요합니다. PyTorch는 데이터를 로드하는데 쉽고 가능하다면
더 좋은 가독성을 가진 코드를 만들기위해 많은 도구들을 제공합니다. 이 레시피에서는 다음 세 가지를 배울 수 있습니다.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>PyTorch 데이터셋 API들을 이용하여 사용자 정의 데이터셋 만들기.</p></li>
<li><p>구성가능하며 호출 될 수 있는 사용자 정의 transform 만들기.</p></li>
<li><p>이러한 컴포넌트들을 합쳐서 사용자 정의 dataloader 만들기.</p></li>
</ol>
</div></blockquote>
<dl class="simple">
<dt>이 튜토리얼을 실행하기 위해서는 다음의 패키지들이 설치 되었는지 확인해 주세요.</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">scikit-image</span></code>: 이미지 I/O와 이미지 변형에 필요합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code>: CSV를 더 쉽게 파싱하기 위해 필요합니다.</p></li>
</ul>
</dd>
</dl>
<p>작성되고 있는 이 시점에서, 이 레시피는 <a class="reference external" href="https://chsasank.github.io">Sasank Chilamkurthy</a> 의 오리지널 튜토리얼을 바탕으로 하며
나중에는 <a class="reference external" href="https://github.com/jspisak">Joe Spisak</a> 에 의해 수정되었습니다.
한국어로 <a class="reference external" href="https://https://github.com/JaeLee18">Jae Joong Lee</a> 에 의해 번역되었습니다.</p>
<section id="id1">
<h2>설정<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>먼저 이 레시피에 필요한 모든 라이브러리들을 불러오도록 하겠습니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">skimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">io</span><span class="p">,</span> <span class="n">transform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision</span><span class="w"> </span><span class="kn">import</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">utils</span>

<span class="c1"># 경고 메시지 무시하기</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>   <span class="c1"># 반응형 모드 설정</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;contextlib.ExitStack object at 0x7fe513b93dd0&gt;
</pre></div>
</div>
</section>
<section id="id2">
<h2>첫 번째: 데이터셋<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>우리가 다룰 데이터셋은 얼굴 포즈입니다.
전반적으로, 한 얼굴에는 68개의 랜드마크들이 표시되어 있습니다.</p>
<p>다음 단계로는, <a class="reference external" href="https://download.pytorch.org/tutorial/faces.zip">여기</a> 에서
데이터셋을 다운 받아 이미지들이 ‘data/faces/’ 의 경로에 위치하게 해주세요.</p>
<p><strong>알림:</strong> 사실 이 데이터셋은 imagenet 데이터셋에서 ‘face’ 태그를 포함하고 있는 이미지에
<cite>dlib</cite> 의 포즈 예측 <a class="reference external" href="https://blog.dlib.net/2014/08/real-time-face-pose-estimation.html">https://blog.dlib.net/2014/08/real-time-face-pose-estimation.html</a> 을 적용하여 생성하였습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget https://download.pytorch.org/tutorial/faces.zip
!mkdir data/faces/
import zipfile
with zipfile.ZipFile(&quot;faces.zip&quot;,&quot;r&quot;) as zip_ref:
zip_ref.extractall(&quot;/data/faces/&quot;)
%cd /data/faces/
</pre></div>
</div>
<p>이 데이터셋은 다음과 같은 설명이 달려있는 CSV파일이 포함되어 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image_name</span><span class="p">,</span><span class="n">part_0_x</span><span class="p">,</span><span class="n">part_0_y</span><span class="p">,</span><span class="n">part_1_x</span><span class="p">,</span><span class="n">part_1_y</span><span class="p">,</span><span class="n">part_2_x</span><span class="p">,</span> <span class="o">...</span> <span class="p">,</span><span class="n">part_67_x</span><span class="p">,</span><span class="n">part_67_y</span>
<span class="mi">0805</span><span class="n">personali01</span><span class="o">.</span><span class="n">jpg</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">83</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span> <span class="o">...</span> <span class="mi">84</span><span class="p">,</span><span class="mi">134</span>
<span class="mi">1084239450</span><span class="n">_e76e00b7e7</span><span class="o">.</span><span class="n">jpg</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">236</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">257</span><span class="p">,</span> <span class="o">...</span> <span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">312</span>
</pre></div>
</div>
<p>이제 CSV파일을 빠르게 읽고 파일 안에 있는 설명들은 (N, 2) 배열로 읽어봅시다.
여기서 N은 랜드마크의 갯수입니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">landmarks_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;faces/face_landmarks.csv&#39;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">65</span>
<span class="n">img_name</span> <span class="o">=</span> <span class="n">landmarks_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">landmarks</span> <span class="o">=</span> <span class="n">landmarks_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="n">landmarks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">landmarks</span><span class="p">)</span>
<span class="n">landmarks</span> <span class="o">=</span> <span class="n">landmarks</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image name: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img_name</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Landmarks shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">landmarks</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First 4 Landmarks: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">landmarks</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-pytb notranslate"><div class="highlight"><pre><span></span><span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/workspace/tutorials-kr/recipes_source/recipes/custom_dataset_transforms_loader.py&quot;</span>, line <span class="m">88</span>, in <span class="n">&lt;module&gt;</span>
<span class="w">    </span><span class="n">landmarks_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;faces/face_landmarks.csv&#39;</span><span class="p">)</span>
<span class="w">                      </span><span class="pm">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
  File <span class="nb">&quot;/opt/conda/lib/python3.11/site-packages/pandas/io/parsers/readers.py&quot;</span>, line <span class="m">1026</span>, in <span class="n">read_csv</span>
<span class="w">    </span><span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
  File <span class="nb">&quot;/opt/conda/lib/python3.11/site-packages/pandas/io/parsers/readers.py&quot;</span>, line <span class="m">620</span>, in <span class="n">_read</span>
<span class="w">    </span><span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="w">             </span><span class="pm">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
  File <span class="nb">&quot;/opt/conda/lib/python3.11/site-packages/pandas/io/parsers/readers.py&quot;</span>, line <span class="m">1620</span>, in <span class="n">__init__</span>
<span class="w">    </span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="w">                   </span><span class="pm">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
  File <span class="nb">&quot;/opt/conda/lib/python3.11/site-packages/pandas/io/parsers/readers.py&quot;</span>, line <span class="m">1880</span>, in <span class="n">_make_engine</span>
<span class="w">    </span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="w">                   </span><span class="pm">^^^^^^^^^^^</span>
  File <span class="nb">&quot;/opt/conda/lib/python3.11/site-packages/pandas/io/common.py&quot;</span>, line <span class="m">873</span>, in <span class="n">get_handle</span>
<span class="w">    </span><span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="w">             </span><span class="pm">^^^^^</span>
<span class="gr">FileNotFoundError</span>: <span class="n">[Errno 2] No such file or directory: &#39;faces/face_landmarks.csv&#39;</span>
</pre></div>
</div>
<section id="id4">
<h3>1.1 이미지를 표시하기 위해 간단한 도움 함수 작성하기<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>다음으로는 이미지를 보여주기 위해 간단한 도움 함수를 작성하여 이미지가 가지고 있는 랜드마크들과
이미지 샘플을 보여주도록 하겠습니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">show_landmarks</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; 랜드마크와 함께 이미지 보여주기 &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">landmarks</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">landmarks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>  <span class="c1">#  잠시 멈추어 도표가 업데이트 되게 합니다</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">show_landmarks</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;faces/&#39;</span><span class="p">,</span> <span class="n">img_name</span><span class="p">)),</span>
               <span class="n">landmarks</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3>1.2 데이터셋 클래스 만들기<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>이제 PyTorch 데이터셋 클래스에 대해 알아봅시다.</p>
<p><code class="docutils literal notranslate"><span class="pre">torch.utils.data.Dataset</span></code> 은 추상 클래스로서 데이터셋을 맡고 있습니다
<code class="docutils literal notranslate"><span class="pre">Dataset</span></code> 을 상속받아야 하며 다음의 메소드들을 오버라이드 해야합니다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__len__</span></code> 에는 <code class="docutils literal notranslate"><span class="pre">len(dataset)</span></code> 데이터셋의 사이즈를 반환합니다.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> 는 이러한 인덱싱을 지원하고 <code class="docutils literal notranslate"><span class="pre">dataset[i]</span></code></dt><dd><p>:math:<code class="docutils literal notranslate"><span class="pre">i</span></code> 번째 샘플을 얻기 위해 사용됩니다.</p>
</dd>
</dl>
</li>
</ul>
<p>우리의 얼굴 랜드마크 데이터셋을 위한 데이터셋 클래스를 만들어 봅시다.
우리는 csv파일은 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 에서 읽고 이미지들은 <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> 에서 읽도록 남겨두겠습니다.
이러한 방법은 메모리를 효율적으로 사용하도록 하는데 그 이유는 모든 이미지를 한 번에 메모리에 저장하지 않고
필요할 때마다 불러오기 때문입니다.</p>
<p>우리 데이터셋의 샘플은 dict 형태로 이렇게 <code class="docutils literal notranslate"><span class="pre">{'image':</span> <span class="pre">image,</span> <span class="pre">'landmarks':</span> <span class="pre">landmarks}</span></code> 되어있습니다.
데이터셋은 선택적 매개변수인 <code class="docutils literal notranslate"><span class="pre">transform</span></code> 을 가지고 있어서
필요한 프로세싱 어느것이나 샘플에 적용 될 수 있습니다.
<code class="docutils literal notranslate"><span class="pre">transform</span></code> 이 얼마나 유용한지는 다른 레시피에서 확인 해 볼 수 있습니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FaceLandmarksDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; 얼굴 랜드마크 데이터셋. &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        매개변수 :</span>
<span class="sd">            csv_file (문자열): 설명이 포함된 csv 파일 경로.</span>
<span class="sd">            root_dir (문자역): 모든 이미지가 있는 폴더 경로.</span>
<span class="sd">            transform (호출가능한 함수, 선택적 매개변수): 샘플에 적용 될 수 있는 선택적 변환.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">=</span> <span class="n">root_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">landmarks_frame</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">img_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">landmarks_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_name</span><span class="p">)</span>
        <span class="n">landmarks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">landmarks_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="n">landmarks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">landmarks</span><span class="p">])</span>
        <span class="n">landmarks</span> <span class="o">=</span> <span class="n">landmarks</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s1">&#39;landmarks&#39;</span><span class="p">:</span> <span class="n">landmarks</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sample</span>
</pre></div>
</div>
</section>
<section id="id6">
<h3>1.3 반복문을 통한 데이터 샘플 사용<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<p>다음으로는 이 클래스를 인스턴스화하고 데이터 샘플을 반복문을 이용하여 사용해봅시다.
우리는 첫 4개의 샘플들만 출력하고 그 4개 샘플들의 랜드마크를 보여주겠습니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">face_dataset</span> <span class="o">=</span> <span class="n">FaceLandmarksDataset</span><span class="p">(</span><span class="n">csv_file</span><span class="o">=</span><span class="s1">&#39;faces/face_landmarks.csv&#39;</span><span class="p">,</span>
                                    <span class="n">root_dir</span><span class="o">=</span><span class="s1">&#39;faces/&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">face_dataset</span><span class="p">)):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">face_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;landmarks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sample #</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">show_landmarks</span><span class="p">(</span><span class="o">**</span><span class="n">sample</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">break</span>
</pre></div>
</div>
</section>
</section>
<section id="id7">
<h2>두 번째: 데이터 변형<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<p>우리는 지금까지 어느정도 사용자 정의 데이터셋을 만들어 보았는데 이제는 사용자 정의 변형을 만들 차례 입니다.
컴퓨터 비전에서는 사용자 정의 변형은 알고리즘을 일반화시키고 정확도를 올리는데 도움을 줍니다.
변형들은 훈련시에 사용이 되며 주로 데이터 증강으로 참조되며 최근의 모델 개발에선 흔히 사용됩니다.</p>
<p>데이터셋을 다룰때 자주 일어나는 문제중 하나는 모든 샘플들이 같은 크기를 가지고 있지 않을 경우입니다.
대부분의 신경망들은 미리 정해진 크기의 이미지들을 받아들입니다.
그렇기 때문에 우리는 전처리 코드를 작성해야할 필요가 있습니다.
이제 세개의 변형을 만들어 봅시다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Rescale</span></code>: 이미지 크기를 변경할때 사용됩니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandomCrop</span></code>: 무작위로 이미지를 잘라내며 데이터 증강에 쓰입니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ToTensor</span></code>: Numpy 이미지들을 파이토치 이미지로 변환할때 사용됩니다. (그러기 위해서는 이미지 차원의 순서를 바꿔야합니다.)</p></li>
</ul>
<p>우리는 위의 세개의 변형들을 단순한 함수 대신에 호출가능한 클래스로 만들어서 매번 변형이 호출될때 항상 매개변수가 넘겨지지 않도록 할겁니다.
그러기 위해서는 우리는 단순히 <code class="docutils literal notranslate"><span class="pre">__call__</span></code> 메소드를 만들고 필요하다면 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 를 만들면 됩니다.
그러면 우리는 변형을 이런식으로 사용할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tsfm</span> <span class="o">=</span> <span class="n">Transform</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">transformed_sample</span> <span class="o">=</span> <span class="n">tsfm</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</pre></div>
</div>
<p>어떻게 이런 변형들이 이미지와 랜드마크에 적용이 되었는지 아래를 봐주시길 바랍니다.</p>
<section id="id8">
<h3>2.1 호출 가능한 클래스들 작성하기<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<p>각각의 변형에 맞는 호출 가능한 클래스 작성을 시작해 봅시다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Rescale</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; 주어진 크기로 샘플안에 있는 이미지를 재변환 합니다.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_size (tuple 또는 int): 원하는 결과값의 크기입니다.</span>
<span class="sd">        tuple로 주어진다면 결과값은 output_size 와 동일해야하며</span>
<span class="sd">        int일때는 설정된 값보다 작은 이미지들의 가로와 세로는 output_size 에 적절한 비율로 변환됩니다.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_size</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="n">output_size</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="n">image</span><span class="p">,</span> <span class="n">landmarks</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;landmarks&#39;</span><span class="p">]</span>

        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="n">w</span><span class="p">:</span>
                <span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">*</span> <span class="n">w</span> <span class="o">/</span> <span class="n">h</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span>

        <span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_h</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_w</span><span class="p">)</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span><span class="p">))</span>

        <span class="c1"># h 와 w  는 이미지의 랜드마크들 때문에 서로 바뀝니다.</span>
        <span class="c1"># x 와 y 축들은 각각 1과 0 값을 가집니다.</span>
        <span class="n">landmarks</span> <span class="o">=</span> <span class="n">landmarks</span> <span class="o">*</span> <span class="p">[</span><span class="n">new_w</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="n">new_h</span> <span class="o">/</span> <span class="n">h</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">img</span><span class="p">,</span> <span class="s1">&#39;landmarks&#39;</span><span class="p">:</span> <span class="n">landmarks</span><span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RandomCrop</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; 샘플에 있는 이미지를 무작위로 자르기.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_size (tuple 또는 int): 원하는 결과값의 크기입니다.</span>
<span class="sd">        int로 설정하시면 정사각형 형태로 자르게 됩니다.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_size</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_size</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="n">output_size</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="n">image</span><span class="p">,</span> <span class="n">landmarks</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;landmarks&#39;</span><span class="p">]</span>

        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span>

        <span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="n">new_h</span><span class="p">)</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="n">new_w</span><span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">top</span><span class="p">:</span> <span class="n">top</span> <span class="o">+</span> <span class="n">new_h</span><span class="p">,</span>
                      <span class="n">left</span><span class="p">:</span> <span class="n">left</span> <span class="o">+</span> <span class="n">new_w</span><span class="p">]</span>

        <span class="n">landmarks</span> <span class="o">=</span> <span class="n">landmarks</span> <span class="o">-</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s1">&#39;landmarks&#39;</span><span class="p">:</span> <span class="n">landmarks</span><span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ToTensor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; 샘플 안에 있는 n차원 배열을 Tensor로 변홥힙니다. &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="n">image</span><span class="p">,</span> <span class="n">landmarks</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;landmarks&#39;</span><span class="p">]</span>

        <span class="c1"># 색깔 축들을 바꿔치기해야하는데 그 이유는 numpy와 torch의 이미지 표현방식이 다르기 때문입니다.</span>
        <span class="c1"># numpy 이미지: H x W x C</span>
        <span class="c1"># torch 이미지: C X H X W</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">image</span><span class="p">),</span>
                <span class="s1">&#39;landmarks&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">landmarks</span><span class="p">)}</span>
</pre></div>
</div>
</section>
<section id="id9">
<h3>2.2 변환들을 구성하고 샘플에 적용해보기.<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>다음에는 작성해왔던 변환들을 구성하고 샘플에 적용해봅시다.</p>
<p>우리가 한 이미지의 가로나 세로중에서 더작은 쪽을 256으로 크기를 바꾸고싶고
바뀐 이미지에서 무작위하게 가로 세로 전부 224로 자르고 싶다고 상황을 가정해봅시다.
예를들면, 우리는 <code class="docutils literal notranslate"><span class="pre">Rescale</span></code> 과 <code class="docutils literal notranslate"><span class="pre">RandomCrop</span></code> 변환을 구성해야 합니다.
<code class="docutils literal notranslate"><span class="pre">torchvision.transforms.Compose</span></code> 는 간단한 호출가능한 클래스로 이러한것들을 우리에게 가능하게 해줍니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">scale</span> <span class="o">=</span> <span class="n">Rescale</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<span class="n">crop</span> <span class="o">=</span> <span class="n">RandomCrop</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="n">composed</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span><span class="n">Rescale</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
                               <span class="n">RandomCrop</span><span class="p">(</span><span class="mi">224</span><span class="p">)])</span>

<span class="c1"># 위에 있는 변환들을 각각 샘플에 적용 시킵니다.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">face_dataset</span><span class="p">[</span><span class="mi">65</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tsfrm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">scale</span><span class="p">,</span> <span class="n">crop</span><span class="p">,</span> <span class="n">composed</span><span class="p">]):</span>
    <span class="n">transformed_sample</span> <span class="o">=</span> <span class="n">tsfrm</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tsfrm</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">show_landmarks</span><span class="p">(</span><span class="o">**</span><span class="n">transformed_sample</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id10">
<h3>2.3 데이터셋을 반복문을 통해 사용하기<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>다음으로 우리는 데이터셋을 반복문을 통해 사용해보도록 하겠습니다.</p>
<p>이제 이 모든것을 다 꺼내어서 변환을 구성하고 데이터셋을 만들어봅시다.
요약하자면 항상 이 데이터셋을 다음과 같이 불러와집니다.</p>
<ul class="simple">
<li><p>이미지는 읽으려고 할때마다 불러옵니다.</p></li>
<li><p>변형들은 읽은 이미지에 적용이 됩니다.</p></li>
<li><p>변형들중 하나는 무작위를 이용하기 때문에, 데이터는 샘플링에 따라 증강됩니다.</p></li>
</ul>
<p>저번에 해본것처럼 생성된 데이터셋을 <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">range</span></code> 이라는 반복문을 통해 사용할 수 있습니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_dataset</span> <span class="o">=</span> <span class="n">FaceLandmarksDataset</span><span class="p">(</span><span class="n">csv_file</span><span class="o">=</span><span class="s1">&#39;faces/face_landmarks.csv&#39;</span><span class="p">,</span>
                                           <span class="n">root_dir</span><span class="o">=</span><span class="s1">&#39;faces/&#39;</span><span class="p">,</span>
                                           <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
                                               <span class="n">Rescale</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
                                               <span class="n">RandomCrop</span><span class="p">(</span><span class="mi">224</span><span class="p">),</span>
                                               <span class="n">ToTensor</span><span class="p">()</span>
                                           <span class="p">]))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transformed_dataset</span><span class="p">)):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">transformed_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;landmarks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</section>
</section>
<section id="dataloader">
<h2>세번째: Dataloader<a class="headerlink" href="#dataloader" title="Link to this heading">#</a></h2>
<p>직접적으로 데이터셋을 <code class="docutils literal notranslate"><span class="pre">for</span></code>  반복문으로 데이터를 이용하는건 많은 특성들을 놓칠 수 밖에 없습니다.
특히, 우리는 다음과 같은 특성들을 놓친다고 할 수 있습니다.</p>
<ul class="simple">
<li><p>데이터 배치</p></li>
<li><p>데이터 섞기</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> 를 이용하여 병렬적으로 데이터 불러오기</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">torch.utils.data.DataLoader</span></code> 는 반복자로서 위에 나와있는 모든 특성들을 제공합니다.
아래에 제시된 사용되는 매개변수들은 쉽게 이해가 될겁니다. 흥미로운 배개변수는 <code class="docutils literal notranslate"><span class="pre">collate_fn</span></code> 인데
이것은 정확하게 <code class="docutils literal notranslate"><span class="pre">collate_fn</span></code> 을 통해 몇개의 샘플들이 배치가 되어야하는지 지정할 수 있습니다.
하지만 굳이 수정하지 않아도 대부분의 경우에는 잘 작동할겁니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">transformed_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                        <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>


<span class="c1"># 배치를 보여주기위한 도움 함수</span>
<span class="k">def</span><span class="w"> </span><span class="nf">show_landmarks_batch</span><span class="p">(</span><span class="n">sample_batched</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; 샘플들의 배치에서 이미지와 함께 랜드마크를 보여줍니다. &quot;&quot;&quot;</span>
    <span class="n">images_batch</span><span class="p">,</span> <span class="n">landmarks_batch</span> <span class="o">=</span> \
            <span class="n">sample_batched</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="n">sample_batched</span><span class="p">[</span><span class="s1">&#39;landmarks&#39;</span><span class="p">]</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_batch</span><span class="p">)</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">images_batch</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">make_grid</span><span class="p">(</span><span class="n">images_batch</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">landmarks_batch</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">im_size</span><span class="p">,</span>
                    <span class="n">landmarks_batch</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
                    <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Batch from dataloader&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i_batch</span><span class="p">,</span> <span class="n">sample_batched</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i_batch</span><span class="p">,</span> <span class="n">sample_batched</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
          <span class="n">sample_batched</span><span class="p">[</span><span class="s1">&#39;landmarks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>

    <span class="c1"># 4번째 배치를 보여주고 반복문을 멈춥니다.</span>
    <span class="k">if</span> <span class="n">i_batch</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">show_landmarks_batch</span><span class="p">(</span><span class="n">sample_batched</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">break</span>
</pre></div>
</div>
<p>이제 PyTorch를 이용해서 어떻게 사용자 정의 dataloader를 만드는지 배웠습니다.
저희는 좀 더 관련된 문서들을 깊게 읽으셔서 더욱 맞춤화된 작업 흐림을 가지길 추천 드립니다.
더 배워보시려면 <code class="docutils literal notranslate"><span class="pre">torch.utils.data</span></code> 문서를 <a class="reference external" href="https://pytorch.org/docs/stable/data.html">여기</a> 에서 읽어 보실 수 있습니다.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.379 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-recipes-recipes-custom-dataset-transforms-loader-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/813e9f58ce3b4f2283d6c6cee9fee5a7/custom_dataset_transforms_loader.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">custom_dataset_transforms_loader.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/f1992c37a58ca1039b273eaac839f845/custom_dataset_transforms_loader.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">custom_dataset_transforms_loader.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/dbbf98569b9be92683886e123d98c2fa/custom_dataset_transforms_loader.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">custom_dataset_transforms_loader.zip</span></code></a></p>
</div>
</div>
</section>
</section>


                </article>
              
  </article>
  
              
              
                <footer class="bd-footer-article">
                  <div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item">
<div class="feedback">
  
<div class="rating">
    Rate this Page
    <div class="stars">
        
        <span class="star" data-behavior="tutorial-rating" data-count="1" data-value="1">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="2" data-value="2">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="3" data-value="3">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="4" data-value="4">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="5" data-value="5">★</span>
        
    </div>
</div>

  <div class="feedback-send">
    <button class="feedback-btn"
            onclick="openGitHubIssue()"
            data-bs-title="Create a GitHub Issue"
            data-bs-placement="bottom"
            data-bs-toggle="tooltip"
            data-gtm="feedback-btn-click">Send Feedback
    </button>
  </div>
</div>

<div class="prev-next-area">
</div>

<div class="footer-info">
  <p class="copyright">
    
      
        © Copyright 2018-2025, PyTorch &amp; 파이토치 한국 사용자 모임(PyTorchKR).
      
      <br/>
    
  </p>

  <p class="theme-version">
    Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
  </p>
</div>
</div>
  
</div>
                </footer>
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc">
<div class="sidebar-secondary-items sidebar-secondary__inner">
    
       <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">설정</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">첫 번째: 데이터셋</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">1.1 이미지를 표시하기 위해 간단한 도움 함수 작성하기</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">1.2 데이터셋 클래스 만들기</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">1.3 반복문을 통한 데이터 샘플 사용</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">두 번째: 데이터 변형</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">2.1 호출 가능한 클래스들 작성하기</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">2.2 변환들을 구성하고 샘플에 적용해보기.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">2.3 데이터셋을 반복문을 통해 사용하기</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataloader">세번째: Dataloader</a></li>
</ul>
  </nav></div>
    




<div class="sidebar-secondary-item">
  <div class="sidebar-heading">PyTorch Libraries</div>
  <ul style="list-style-type: none; padding: 0; padding-bottom: 80px;">
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/ao" style="color: var(--pst-color-text-muted)">torchao</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchrec" style="color: var(--pst-color-text-muted)">torchrec</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchft" style="color: var(--pst-color-text-muted)">torchft</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchcodec" style="color: var(--pst-color-text-muted)">TorchCodec</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/vision" style="color: var(--pst-color-text-muted)">torchvision</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/executorch" style="color: var(--pst-color-text-muted)">ExecuTorch</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/xla" style="color: var(--pst-color-text-muted)">PyTorch on XLA Devices</a></li>
  
  </ul>
</div>

</div>
</div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <div class="container-fluid docs-tutorials-resources">
  <div class="container">
    <div class="row">
      <div class="col-md-4 text-center">
        <h2>PyTorchKorea @ GitHub</h2>
        <p>파이토치 한국 사용자 모임을 GitHub에서 만나보세요.</p>
        <a class="with-right-arrow" href="https://github.com/PyTorchKorea">GitHub로 이동</a>
      </div>

      <div class="col-md-4 text-center">
        <h2>한국어 튜토리얼</h2>
        <p>한국어로 번역 중인 파이토치 튜토리얼을 만나보세요.</p>
        <a class="with-right-arrow" href="https://tutorials.pytorch.kr/">튜토리얼로 이동</a>
      </div>

      <div class="col-md-4 text-center">
        <h2>한국어 커뮤니티</h2>
        <p>다른 사용자들과 의견을 나누고, 도와주세요!</p>
        <a class="with-right-arrow" href="https://discuss.pytorch.kr/">커뮤니티로 이동</a>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="container footer-container">
    <div class="footer-logo-wrapper">
      <a href="https://pytorch.kr/" class="footer-logo"></a>
    </div>

    <div class="footer-links-wrapper">
      <div class="footer-links-col">
        <ul>
          <li class="list-title"><a href="https://pytorch.kr/">파이토치 한국 사용자 모임</a></li>
          <li><a href="https://pytorch.kr/about">사용자 모임 소개</a></li>
          <li><a href="https://pytorch.kr/contributors">기여해주신 분들</a></li>
          <li><a href="https://pytorch.kr/resources/">리소스</a></li>
          <li><a href="https://pytorch.kr/coc">행동 강령</a></li>
        </ul>
      </div>
    </div>

    <div class="trademark-disclaimer">
      <ul>
        <li>이 사이트는 독립적인 파이토치 사용자 커뮤니티로, 최신 버전이 아니거나 잘못된 내용이 포함되어 있을 수 있습니다. This site is an independent user community and may be out of date or contain incorrect information.</li>
        <li><a href="https://pytorch.kr/coc">행동 강령</a>을 읽고 지켜주세요. PyTorch 공식 로고 사용 규정은 <a href="https://www.linuxfoundation.org/policies/">Linux Foundation의 정책</a>을 따릅니다. Please read and follow <a href="https://pytorch.kr/coc">our code of conduct</a>. All PyTorch trademark policy applicable to <a href="https://www.linuxfoundation.org/policies/">Linux Foundation's policies</a>.</li>
      </ul>
    </div>
  </div>
</footer>

<div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../_static/img/pytorch-x.svg">
  </div>
</div>
  
  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2018-2025, PyTorch &amp; 파이토치 한국 사용자 모임(PyTorchKR).
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6 버전으로 생성되었습니다.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  <script type="application/ld+json">
    {
       "@context": "https://schema.org",
       "@type": "Article",
       "name": "\uc0ac\uc6a9\uc790 \uc815\uc758 PyTorch Dataloader \uc791\uc131\ud558\uae30",
       "headline": "\uc0ac\uc6a9\uc790 \uc815\uc758 PyTorch Dataloader \uc791\uc131\ud558\uae30",
       "description": "PyTorch Documentation. Explore PyTorch, an open-source machine learning library that accelerates the path from research prototyping to production deployment. Discover tutorials, API references, and guides to help you build and deploy deep learning models efficiently.",
       "url": "/recipes/recipes/custom_dataset_transforms_loader.html",
       "articleBody": "\ucc38\uace0 Go to the end to download the full example code. \uc0ac\uc6a9\uc790 \uc815\uc758 PyTorch Dataloader \uc791\uc131\ud558\uae30# \uba38\uc2e0\ub7ec\ub2dd \uc54c\uace0\ub9ac\uc998\uc744 \uac1c\ubc1c\ud558\uae30 \uc704\ud574\uc11c\ub294 \ub370\uc774\ud130 \uc804\ucc98\ub9ac\uc5d0 \ub9ce\uc740 \ub178\ub825\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. PyTorch\ub294 \ub370\uc774\ud130\ub97c \ub85c\ub4dc\ud558\ub294\ub370 \uc27d\uace0 \uac00\ub2a5\ud558\ub2e4\uba74 \ub354 \uc88b\uc740 \uac00\ub3c5\uc131\uc744 \uac00\uc9c4 \ucf54\ub4dc\ub97c \ub9cc\ub4e4\uae30\uc704\ud574 \ub9ce\uc740 \ub3c4\uad6c\ub4e4\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc774 \ub808\uc2dc\ud53c\uc5d0\uc11c\ub294 \ub2e4\uc74c \uc138 \uac00\uc9c0\ub97c \ubc30\uc6b8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. PyTorch \ub370\uc774\ud130\uc14b API\ub4e4\uc744 \uc774\uc6a9\ud558\uc5ec \uc0ac\uc6a9\uc790 \uc815\uc758 \ub370\uc774\ud130\uc14b \ub9cc\ub4e4\uae30. \uad6c\uc131\uac00\ub2a5\ud558\uba70 \ud638\ucd9c \ub420 \uc218 \uc788\ub294 \uc0ac\uc6a9\uc790 \uc815\uc758 transform \ub9cc\ub4e4\uae30. \uc774\ub7ec\ud55c \ucef4\ud3ec\ub10c\ud2b8\ub4e4\uc744 \ud569\uccd0\uc11c \uc0ac\uc6a9\uc790 \uc815\uc758 dataloader \ub9cc\ub4e4\uae30. \uc774 \ud29c\ud1a0\ub9ac\uc5bc\uc744 \uc2e4\ud589\ud558\uae30 \uc704\ud574\uc11c\ub294 \ub2e4\uc74c\uc758 \ud328\ud0a4\uc9c0\ub4e4\uc774 \uc124\uce58 \ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud574 \uc8fc\uc138\uc694. scikit-image: \uc774\ubbf8\uc9c0 I/O\uc640 \uc774\ubbf8\uc9c0 \ubcc0\ud615\uc5d0 \ud544\uc694\ud569\ub2c8\ub2e4. pandas: CSV\ub97c \ub354 \uc27d\uac8c \ud30c\uc2f1\ud558\uae30 \uc704\ud574 \ud544\uc694\ud569\ub2c8\ub2e4. \uc791\uc131\ub418\uace0 \uc788\ub294 \uc774 \uc2dc\uc810\uc5d0\uc11c, \uc774 \ub808\uc2dc\ud53c\ub294 Sasank Chilamkurthy \uc758 \uc624\ub9ac\uc9c0\ub110 \ud29c\ud1a0\ub9ac\uc5bc\uc744 \ubc14\ud0d5\uc73c\ub85c \ud558\uba70 \ub098\uc911\uc5d0\ub294 Joe Spisak \uc5d0 \uc758\ud574 \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ud55c\uad6d\uc5b4\ub85c Jae Joong Lee \uc5d0 \uc758\ud574 \ubc88\uc5ed\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc124\uc815# \uba3c\uc800 \uc774 \ub808\uc2dc\ud53c\uc5d0 \ud544\uc694\ud55c \ubaa8\ub4e0 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub4e4\uc744 \ubd88\ub7ec\uc624\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4. from __future__ import print_function, division import os import torch import pandas as pd from skimage import io, transform import numpy as np import matplotlib.pyplot as plt from torch.utils.data import Dataset, DataLoader from torchvision import transforms, utils # \uacbd\uace0 \uba54\uc2dc\uc9c0 \ubb34\uc2dc\ud558\uae30 import warnings warnings.filterwarnings(\"ignore\") plt.ion() # \ubc18\uc751\ud615 \ubaa8\ub4dc \uc124\uc815 \u003ccontextlib.ExitStack object at 0x7fe513b93dd0\u003e \uccab \ubc88\uc9f8: \ub370\uc774\ud130\uc14b# \uc6b0\ub9ac\uac00 \ub2e4\ub8f0 \ub370\uc774\ud130\uc14b\uc740 \uc5bc\uad74 \ud3ec\uc988\uc785\ub2c8\ub2e4. \uc804\ubc18\uc801\uc73c\ub85c, \ud55c \uc5bc\uad74\uc5d0\ub294 68\uac1c\uc758 \ub79c\ub4dc\ub9c8\ud06c\ub4e4\uc774 \ud45c\uc2dc\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \ub2e8\uacc4\ub85c\ub294, \uc5ec\uae30 \uc5d0\uc11c \ub370\uc774\ud130\uc14b\uc744 \ub2e4\uc6b4 \ubc1b\uc544 \uc774\ubbf8\uc9c0\ub4e4\uc774 \u2018data/faces/\u2019 \uc758 \uacbd\ub85c\uc5d0 \uc704\uce58\ud558\uac8c \ud574\uc8fc\uc138\uc694. \uc54c\ub9bc: \uc0ac\uc2e4 \uc774 \ub370\uc774\ud130\uc14b\uc740 imagenet \ub370\uc774\ud130\uc14b\uc5d0\uc11c \u2018face\u2019 \ud0dc\uadf8\ub97c \ud3ec\ud568\ud558\uace0 \uc788\ub294 \uc774\ubbf8\uc9c0\uc5d0 dlib \uc758 \ud3ec\uc988 \uc608\uce21 https://blog.dlib.net/2014/08/real-time-face-pose-estimation.html \uc744 \uc801\uc6a9\ud558\uc5ec \uc0dd\uc131\ud558\uc600\uc2b5\ub2c8\ub2e4. !wget https://download.pytorch.org/tutorial/faces.zip !mkdir data/faces/ import zipfile with zipfile.ZipFile(\"faces.zip\",\"r\") as zip_ref: zip_ref.extractall(\"/data/faces/\") %cd /data/faces/ \uc774 \ub370\uc774\ud130\uc14b\uc740 \ub2e4\uc74c\uacfc \uac19\uc740 \uc124\uba85\uc774 \ub2ec\ub824\uc788\ub294 CSV\ud30c\uc77c\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. image_name,part_0_x,part_0_y,part_1_x,part_1_y,part_2_x, ... ,part_67_x,part_67_y 0805personali01.jpg,27,83,27,98, ... 84,134 1084239450_e76e00b7e7.jpg,70,236,71,257, ... ,128,312 \uc774\uc81c CSV\ud30c\uc77c\uc744 \ube60\ub974\uac8c \uc77d\uace0 \ud30c\uc77c \uc548\uc5d0 \uc788\ub294 \uc124\uba85\ub4e4\uc740 (N, 2) \ubc30\uc5f4\ub85c \uc77d\uc5b4\ubd05\uc2dc\ub2e4. \uc5ec\uae30\uc11c N\uc740 \ub79c\ub4dc\ub9c8\ud06c\uc758 \uac2f\uc218\uc785\ub2c8\ub2e4. landmarks_frame = pd.read_csv(\u0027faces/face_landmarks.csv\u0027) n = 65 img_name = landmarks_frame.iloc[n, 0] landmarks = landmarks_frame.iloc[n, 1:] landmarks = np.asarray(landmarks) landmarks = landmarks.astype(\u0027float\u0027).reshape(-1, 2) print(\u0027Image name: {}\u0027.format(img_name)) print(\u0027Landmarks shape: {}\u0027.format(landmarks.shape)) print(\u0027First 4 Landmarks: {}\u0027.format(landmarks[:4])) Traceback (most recent call last): File \"/workspace/tutorials-kr/recipes_source/recipes/custom_dataset_transforms_loader.py\", line 88, in \u003cmodule\u003e landmarks_frame = pd.read_csv(\u0027faces/face_landmarks.csv\u0027) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File \"/opt/conda/lib/python3.11/site-packages/pandas/io/parsers/readers.py\", line 1026, in read_csv return _read(filepath_or_buffer, kwds) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File \"/opt/conda/lib/python3.11/site-packages/pandas/io/parsers/readers.py\", line 620, in _read parser = TextFileReader(filepath_or_buffer, **kwds) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File \"/opt/conda/lib/python3.11/site-packages/pandas/io/parsers/readers.py\", line 1620, in __init__ self._engine = self._make_engine(f, self.engine) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File \"/opt/conda/lib/python3.11/site-packages/pandas/io/parsers/readers.py\", line 1880, in _make_engine self.handles = get_handle( ^^^^^^^^^^^ File \"/opt/conda/lib/python3.11/site-packages/pandas/io/common.py\", line 873, in get_handle handle = open( ^^^^^ FileNotFoundError: [Errno 2] No such file or directory: \u0027faces/face_landmarks.csv\u0027 1.1 \uc774\ubbf8\uc9c0\ub97c \ud45c\uc2dc\ud558\uae30 \uc704\ud574 \uac04\ub2e8\ud55c \ub3c4\uc6c0 \ud568\uc218 \uc791\uc131\ud558\uae30# \ub2e4\uc74c\uc73c\ub85c\ub294 \uc774\ubbf8\uc9c0\ub97c \ubcf4\uc5ec\uc8fc\uae30 \uc704\ud574 \uac04\ub2e8\ud55c \ub3c4\uc6c0 \ud568\uc218\ub97c \uc791\uc131\ud558\uc5ec \uc774\ubbf8\uc9c0\uac00 \uac00\uc9c0\uace0 \uc788\ub294 \ub79c\ub4dc\ub9c8\ud06c\ub4e4\uacfc \uc774\ubbf8\uc9c0 \uc0d8\ud50c\uc744 \ubcf4\uc5ec\uc8fc\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4. def show_landmarks(image, landmarks): \"\"\" \ub79c\ub4dc\ub9c8\ud06c\uc640 \ud568\uaed8 \uc774\ubbf8\uc9c0 \ubcf4\uc5ec\uc8fc\uae30 \"\"\" plt.imshow(image) plt.scatter(landmarks[:, 0], landmarks[:, 1], s=10, marker=\u0027.\u0027, c=\u0027r\u0027) plt.pause(0.001) # \uc7a0\uc2dc \uba48\ucd94\uc5b4 \ub3c4\ud45c\uac00 \uc5c5\ub370\uc774\ud2b8 \ub418\uac8c \ud569\ub2c8\ub2e4 plt.figure() show_landmarks(io.imread(os.path.join(\u0027faces/\u0027, img_name)), landmarks) plt.show() 1.2 \ub370\uc774\ud130\uc14b \ud074\ub798\uc2a4 \ub9cc\ub4e4\uae30# \uc774\uc81c PyTorch \ub370\uc774\ud130\uc14b \ud074\ub798\uc2a4\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\uc2dc\ub2e4. torch.utils.data.Dataset \uc740 \ucd94\uc0c1 \ud074\ub798\uc2a4\ub85c\uc11c \ub370\uc774\ud130\uc14b\uc744 \ub9e1\uace0 \uc788\uc2b5\ub2c8\ub2e4 Dataset \uc744 \uc0c1\uc18d\ubc1b\uc544\uc57c \ud558\uba70 \ub2e4\uc74c\uc758 \uba54\uc18c\ub4dc\ub4e4\uc744 \uc624\ubc84\ub77c\uc774\ub4dc \ud574\uc57c\ud569\ub2c8\ub2e4. __len__ \uc5d0\ub294 len(dataset) \ub370\uc774\ud130\uc14b\uc758 \uc0ac\uc774\uc988\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. __getitem__ \ub294 \uc774\ub7ec\ud55c \uc778\ub371\uc2f1\uc744 \uc9c0\uc6d0\ud558\uace0 dataset[i]:math:i \ubc88\uc9f8 \uc0d8\ud50c\uc744 \uc5bb\uae30 \uc704\ud574 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc6b0\ub9ac\uc758 \uc5bc\uad74 \ub79c\ub4dc\ub9c8\ud06c \ub370\uc774\ud130\uc14b\uc744 \uc704\ud55c \ub370\uc774\ud130\uc14b \ud074\ub798\uc2a4\ub97c \ub9cc\ub4e4\uc5b4 \ubd05\uc2dc\ub2e4. \uc6b0\ub9ac\ub294 csv\ud30c\uc77c\uc740 __init__ \uc5d0\uc11c \uc77d\uace0 \uc774\ubbf8\uc9c0\ub4e4\uc740 __getitem__ \uc5d0\uc11c \uc77d\ub3c4\ub85d \ub0a8\uaca8\ub450\uaca0\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ubc29\ubc95\uc740 \uba54\ubaa8\ub9ac\ub97c \ud6a8\uc728\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\ub3c4\ub85d \ud558\ub294\ub370 \uadf8 \uc774\uc720\ub294 \ubaa8\ub4e0 \uc774\ubbf8\uc9c0\ub97c \ud55c \ubc88\uc5d0 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\ud558\uc9c0 \uc54a\uace0 \ud544\uc694\ud560 \ub54c\ub9c8\ub2e4 \ubd88\ub7ec\uc624\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uc6b0\ub9ac \ub370\uc774\ud130\uc14b\uc758 \uc0d8\ud50c\uc740 dict \ud615\ud0dc\ub85c \uc774\ub807\uac8c {\u0027image\u0027: image, \u0027landmarks\u0027: landmarks} \ub418\uc5b4\uc788\uc2b5\ub2c8\ub2e4. \ub370\uc774\ud130\uc14b\uc740 \uc120\ud0dd\uc801 \ub9e4\uac1c\ubcc0\uc218\uc778 transform \uc744 \uac00\uc9c0\uace0 \uc788\uc5b4\uc11c \ud544\uc694\ud55c \ud504\ub85c\uc138\uc2f1 \uc5b4\ub290\uac83\uc774\ub098 \uc0d8\ud50c\uc5d0 \uc801\uc6a9 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. transform \uc774 \uc5bc\ub9c8\ub098 \uc720\uc6a9\ud55c\uc9c0\ub294 \ub2e4\ub978 \ub808\uc2dc\ud53c\uc5d0\uc11c \ud655\uc778 \ud574 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. class FaceLandmarksDataset(Dataset): \"\"\" \uc5bc\uad74 \ub79c\ub4dc\ub9c8\ud06c \ub370\uc774\ud130\uc14b. \"\"\" def __init__(self, csv_file, root_dir, transform=None): \"\"\" \ub9e4\uac1c\ubcc0\uc218 : csv_file (\ubb38\uc790\uc5f4): \uc124\uba85\uc774 \ud3ec\ud568\ub41c csv \ud30c\uc77c \uacbd\ub85c. root_dir (\ubb38\uc790\uc5ed): \ubaa8\ub4e0 \uc774\ubbf8\uc9c0\uac00 \uc788\ub294 \ud3f4\ub354 \uacbd\ub85c. transform (\ud638\ucd9c\uac00\ub2a5\ud55c \ud568\uc218, \uc120\ud0dd\uc801 \ub9e4\uac1c\ubcc0\uc218): \uc0d8\ud50c\uc5d0 \uc801\uc6a9 \ub420 \uc218 \uc788\ub294 \uc120\ud0dd\uc801 \ubcc0\ud658. \"\"\" self.landmarks_frame = pd.read_csv(csv_file) self.root_dir = root_dir self.transform = transform def __len__(self): return len(self.landmarks_frame) def __getitem__(self, idx): if torch.is_tensor(idx): idx = idx.tolist() img_name = os.path.join(self.root_dir, self.landmarks_frame.iloc[idx, 0]) image = io.imread(img_name) landmarks = self.landmarks_frame.iloc[idx, 1:] landmarks = np.array([landmarks]) landmarks = landmarks.astype(\u0027float\u0027).reshape(-1, 2) sample = {\u0027image\u0027: image, \u0027landmarks\u0027: landmarks} if self.transform: sample = self.transform(sample) return sample 1.3 \ubc18\ubcf5\ubb38\uc744 \ud1b5\ud55c \ub370\uc774\ud130 \uc0d8\ud50c \uc0ac\uc6a9# \ub2e4\uc74c\uc73c\ub85c\ub294 \uc774 \ud074\ub798\uc2a4\ub97c \uc778\uc2a4\ud134\uc2a4\ud654\ud558\uace0 \ub370\uc774\ud130 \uc0d8\ud50c\uc744 \ubc18\ubcf5\ubb38\uc744 \uc774\uc6a9\ud558\uc5ec \uc0ac\uc6a9\ud574\ubd05\uc2dc\ub2e4. \uc6b0\ub9ac\ub294 \uccab 4\uac1c\uc758 \uc0d8\ud50c\ub4e4\ub9cc \ucd9c\ub825\ud558\uace0 \uadf8 4\uac1c \uc0d8\ud50c\ub4e4\uc758 \ub79c\ub4dc\ub9c8\ud06c\ub97c \ubcf4\uc5ec\uc8fc\uaca0\uc2b5\ub2c8\ub2e4. face_dataset = FaceLandmarksDataset(csv_file=\u0027faces/face_landmarks.csv\u0027, root_dir=\u0027faces/\u0027) fig = plt.figure() for i in range(len(face_dataset)): sample = face_dataset[i] print(i, sample[\u0027image\u0027].shape, sample[\u0027landmarks\u0027].shape) ax = plt.subplot(1, 4, i + 1) plt.tight_layout() ax.set_title(\u0027Sample #{}\u0027.format(i)) ax.axis(\u0027off\u0027) show_landmarks(**sample) if i == 3: plt.show() break \ub450 \ubc88\uc9f8: \ub370\uc774\ud130 \ubcc0\ud615# \uc6b0\ub9ac\ub294 \uc9c0\uae08\uae4c\uc9c0 \uc5b4\ub290\uc815\ub3c4 \uc0ac\uc6a9\uc790 \uc815\uc758 \ub370\uc774\ud130\uc14b\uc744 \ub9cc\ub4e4\uc5b4 \ubcf4\uc558\ub294\ub370 \uc774\uc81c\ub294 \uc0ac\uc6a9\uc790 \uc815\uc758 \ubcc0\ud615\uc744 \ub9cc\ub4e4 \ucc28\ub840 \uc785\ub2c8\ub2e4. \ucef4\ud4e8\ud130 \ube44\uc804\uc5d0\uc11c\ub294 \uc0ac\uc6a9\uc790 \uc815\uc758 \ubcc0\ud615\uc740 \uc54c\uace0\ub9ac\uc998\uc744 \uc77c\ubc18\ud654\uc2dc\ud0a4\uace0 \uc815\ud655\ub3c4\ub97c \uc62c\ub9ac\ub294\ub370 \ub3c4\uc6c0\uc744 \uc90d\ub2c8\ub2e4. \ubcc0\ud615\ub4e4\uc740 \ud6c8\ub828\uc2dc\uc5d0 \uc0ac\uc6a9\uc774 \ub418\uba70 \uc8fc\ub85c \ub370\uc774\ud130 \uc99d\uac15\uc73c\ub85c \ucc38\uc870\ub418\uba70 \ucd5c\uadfc\uc758 \ubaa8\ub378 \uac1c\ubc1c\uc5d0\uc120 \ud754\ud788 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \ub370\uc774\ud130\uc14b\uc744 \ub2e4\ub8f0\ub54c \uc790\uc8fc \uc77c\uc5b4\ub098\ub294 \ubb38\uc81c\uc911 \ud558\ub098\ub294 \ubaa8\ub4e0 \uc0d8\ud50c\ub4e4\uc774 \uac19\uc740 \ud06c\uae30\ub97c \uac00\uc9c0\uace0 \uc788\uc9c0 \uc54a\uc744 \uacbd\uc6b0\uc785\ub2c8\ub2e4. \ub300\ubd80\ubd84\uc758 \uc2e0\uacbd\ub9dd\ub4e4\uc740 \ubbf8\ub9ac \uc815\ud574\uc9c4 \ud06c\uae30\uc758 \uc774\ubbf8\uc9c0\ub4e4\uc744 \ubc1b\uc544\ub4e4\uc785\ub2c8\ub2e4. \uadf8\ub807\uae30 \ub54c\ubb38\uc5d0 \uc6b0\ub9ac\ub294 \uc804\ucc98\ub9ac \ucf54\ub4dc\ub97c \uc791\uc131\ud574\uc57c\ud560 \ud544\uc694\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc774\uc81c \uc138\uac1c\uc758 \ubcc0\ud615\uc744 \ub9cc\ub4e4\uc5b4 \ubd05\uc2dc\ub2e4. Rescale: \uc774\ubbf8\uc9c0 \ud06c\uae30\ub97c \ubcc0\uacbd\ud560\ub54c \uc0ac\uc6a9\ub429\ub2c8\ub2e4. RandomCrop: \ubb34\uc791\uc704\ub85c \uc774\ubbf8\uc9c0\ub97c \uc798\ub77c\ub0b4\uba70 \ub370\uc774\ud130 \uc99d\uac15\uc5d0 \uc4f0\uc785\ub2c8\ub2e4. ToTensor: Numpy \uc774\ubbf8\uc9c0\ub4e4\uc744 \ud30c\uc774\ud1a0\uce58 \uc774\ubbf8\uc9c0\ub85c \ubcc0\ud658\ud560\ub54c \uc0ac\uc6a9\ub429\ub2c8\ub2e4. (\uadf8\ub7ec\uae30 \uc704\ud574\uc11c\ub294 \uc774\ubbf8\uc9c0 \ucc28\uc6d0\uc758 \uc21c\uc11c\ub97c \ubc14\uafd4\uc57c\ud569\ub2c8\ub2e4.) \uc6b0\ub9ac\ub294 \uc704\uc758 \uc138\uac1c\uc758 \ubcc0\ud615\ub4e4\uc744 \ub2e8\uc21c\ud55c \ud568\uc218 \ub300\uc2e0\uc5d0 \ud638\ucd9c\uac00\ub2a5\ud55c \ud074\ub798\uc2a4\ub85c \ub9cc\ub4e4\uc5b4\uc11c \ub9e4\ubc88 \ubcc0\ud615\uc774 \ud638\ucd9c\ub420\ub54c \ud56d\uc0c1 \ub9e4\uac1c\ubcc0\uc218\uac00 \ub118\uaca8\uc9c0\uc9c0 \uc54a\ub3c4\ub85d \ud560\uac81\ub2c8\ub2e4. \uadf8\ub7ec\uae30 \uc704\ud574\uc11c\ub294 \uc6b0\ub9ac\ub294 \ub2e8\uc21c\ud788 __call__ \uba54\uc18c\ub4dc\ub97c \ub9cc\ub4e4\uace0 \ud544\uc694\ud558\ub2e4\uba74 __init__ \ub97c \ub9cc\ub4e4\uba74 \ub429\ub2c8\ub2e4. \uadf8\ub7ec\uba74 \uc6b0\ub9ac\ub294 \ubcc0\ud615\uc744 \uc774\ub7f0\uc2dd\uc73c\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. tsfm = Transform(params) transformed_sample = tsfm(sample) \uc5b4\ub5bb\uac8c \uc774\ub7f0 \ubcc0\ud615\ub4e4\uc774 \uc774\ubbf8\uc9c0\uc640 \ub79c\ub4dc\ub9c8\ud06c\uc5d0 \uc801\uc6a9\uc774 \ub418\uc5c8\ub294\uc9c0 \uc544\ub798\ub97c \ubd10\uc8fc\uc2dc\uae38 \ubc14\ub78d\ub2c8\ub2e4. 2.1 \ud638\ucd9c \uac00\ub2a5\ud55c \ud074\ub798\uc2a4\ub4e4 \uc791\uc131\ud558\uae30# \uac01\uac01\uc758 \ubcc0\ud615\uc5d0 \ub9de\ub294 \ud638\ucd9c \uac00\ub2a5\ud55c \ud074\ub798\uc2a4 \uc791\uc131\uc744 \uc2dc\uc791\ud574 \ubd05\uc2dc\ub2e4. class Rescale(object): \"\"\" \uc8fc\uc5b4\uc9c4 \ud06c\uae30\ub85c \uc0d8\ud50c\uc548\uc5d0 \uc788\ub294 \uc774\ubbf8\uc9c0\ub97c \uc7ac\ubcc0\ud658 \ud569\ub2c8\ub2e4. Args: output_size (tuple \ub610\ub294 int): \uc6d0\ud558\ub294 \uacb0\uacfc\uac12\uc758 \ud06c\uae30\uc785\ub2c8\ub2e4. tuple\ub85c \uc8fc\uc5b4\uc9c4\ub2e4\uba74 \uacb0\uacfc\uac12\uc740 output_size \uc640 \ub3d9\uc77c\ud574\uc57c\ud558\uba70 int\uc77c\ub54c\ub294 \uc124\uc815\ub41c \uac12\ubcf4\ub2e4 \uc791\uc740 \uc774\ubbf8\uc9c0\ub4e4\uc758 \uac00\ub85c\uc640 \uc138\ub85c\ub294 output_size \uc5d0 \uc801\uc808\ud55c \ube44\uc728\ub85c \ubcc0\ud658\ub429\ub2c8\ub2e4. \"\"\" def __init__(self, output_size): assert isinstance(output_size, (int, tuple)) self.output_size = output_size def __call__(self, sample): image, landmarks = sample[\u0027image\u0027], sample[\u0027landmarks\u0027] h, w = image.shape[:2] if isinstance(self.output_size, int): if h \u003e w: new_h, new_w = self.output_size * h / w, self.output_size else: new_h, new_w = self.output_size, self.output_size * w / h else: new_h, new_w = self.output_size new_h, new_w = int(new_h), int(new_w) img = transform.resize(image, (new_h, new_w)) # h \uc640 w \ub294 \uc774\ubbf8\uc9c0\uc758 \ub79c\ub4dc\ub9c8\ud06c\ub4e4 \ub54c\ubb38\uc5d0 \uc11c\ub85c \ubc14\ub01d\ub2c8\ub2e4. # x \uc640 y \ucd95\ub4e4\uc740 \uac01\uac01 1\uacfc 0 \uac12\uc744 \uac00\uc9d1\ub2c8\ub2e4. landmarks = landmarks * [new_w / w, new_h / h] return {\u0027image\u0027: img, \u0027landmarks\u0027: landmarks} class RandomCrop(object): \"\"\" \uc0d8\ud50c\uc5d0 \uc788\ub294 \uc774\ubbf8\uc9c0\ub97c \ubb34\uc791\uc704\ub85c \uc790\ub974\uae30. Args: output_size (tuple \ub610\ub294 int): \uc6d0\ud558\ub294 \uacb0\uacfc\uac12\uc758 \ud06c\uae30\uc785\ub2c8\ub2e4. int\ub85c \uc124\uc815\ud558\uc2dc\uba74 \uc815\uc0ac\uac01\ud615 \ud615\ud0dc\ub85c \uc790\ub974\uac8c \ub429\ub2c8\ub2e4. \"\"\" def __init__(self, output_size): assert isinstance(output_size, (int, tuple)) if isinstance(output_size, int): self.output_size = (output_size, output_size) else: assert len(output_size) == 2 self.output_size = output_size def __call__(self, sample): image, landmarks = sample[\u0027image\u0027], sample[\u0027landmarks\u0027] h, w = image.shape[:2] new_h, new_w = self.output_size top = np.random.randint(0, h - new_h) left = np.random.randint(0, w - new_w) image = image[top: top + new_h, left: left + new_w] landmarks = landmarks - [left, top] return {\u0027image\u0027: image, \u0027landmarks\u0027: landmarks} class ToTensor(object): \"\"\" \uc0d8\ud50c \uc548\uc5d0 \uc788\ub294 n\ucc28\uc6d0 \ubc30\uc5f4\uc744 Tensor\ub85c \ubcc0\ud665\ud799\ub2c8\ub2e4. \"\"\" def __call__(self, sample): image, landmarks = sample[\u0027image\u0027], sample[\u0027landmarks\u0027] # \uc0c9\uae54 \ucd95\ub4e4\uc744 \ubc14\uafd4\uce58\uae30\ud574\uc57c\ud558\ub294\ub370 \uadf8 \uc774\uc720\ub294 numpy\uc640 torch\uc758 \uc774\ubbf8\uc9c0 \ud45c\ud604\ubc29\uc2dd\uc774 \ub2e4\ub974\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. # numpy \uc774\ubbf8\uc9c0: H x W x C # torch \uc774\ubbf8\uc9c0: C X H X W image = image.transpose((2, 0, 1)) return {\u0027image\u0027: torch.from_numpy(image), \u0027landmarks\u0027: torch.from_numpy(landmarks)} 2.2 \ubcc0\ud658\ub4e4\uc744 \uad6c\uc131\ud558\uace0 \uc0d8\ud50c\uc5d0 \uc801\uc6a9\ud574\ubcf4\uae30.# \ub2e4\uc74c\uc5d0\ub294 \uc791\uc131\ud574\uc654\ub358 \ubcc0\ud658\ub4e4\uc744 \uad6c\uc131\ud558\uace0 \uc0d8\ud50c\uc5d0 \uc801\uc6a9\ud574\ubd05\uc2dc\ub2e4. \uc6b0\ub9ac\uac00 \ud55c \uc774\ubbf8\uc9c0\uc758 \uac00\ub85c\ub098 \uc138\ub85c\uc911\uc5d0\uc11c \ub354\uc791\uc740 \ucabd\uc744 256\uc73c\ub85c \ud06c\uae30\ub97c \ubc14\uafb8\uace0\uc2f6\uace0 \ubc14\ub010 \uc774\ubbf8\uc9c0\uc5d0\uc11c \ubb34\uc791\uc704\ud558\uac8c \uac00\ub85c \uc138\ub85c \uc804\ubd80 224\ub85c \uc790\ub974\uace0 \uc2f6\ub2e4\uace0 \uc0c1\ud669\uc744 \uac00\uc815\ud574\ubd05\uc2dc\ub2e4. \uc608\ub97c\ub4e4\uba74, \uc6b0\ub9ac\ub294 Rescale \uacfc RandomCrop \ubcc0\ud658\uc744 \uad6c\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. torchvision.transforms.Compose \ub294 \uac04\ub2e8\ud55c \ud638\ucd9c\uac00\ub2a5\ud55c \ud074\ub798\uc2a4\ub85c \uc774\ub7ec\ud55c\uac83\ub4e4\uc744 \uc6b0\ub9ac\uc5d0\uac8c \uac00\ub2a5\ud558\uac8c \ud574\uc90d\ub2c8\ub2e4. scale = Rescale(256) crop = RandomCrop(128) composed = transforms.Compose([Rescale(256), RandomCrop(224)]) # \uc704\uc5d0 \uc788\ub294 \ubcc0\ud658\ub4e4\uc744 \uac01\uac01 \uc0d8\ud50c\uc5d0 \uc801\uc6a9 \uc2dc\ud0b5\ub2c8\ub2e4. fig = plt.figure() sample = face_dataset[65] for i, tsfrm in enumerate([scale, crop, composed]): transformed_sample = tsfrm(sample) ax = plt.subplot(1, 3, i + 1) plt.tight_layout() ax.set_title(type(tsfrm).__name__) show_landmarks(**transformed_sample) plt.show() 2.3 \ub370\uc774\ud130\uc14b\uc744 \ubc18\ubcf5\ubb38\uc744 \ud1b5\ud574 \uc0ac\uc6a9\ud558\uae30# \ub2e4\uc74c\uc73c\ub85c \uc6b0\ub9ac\ub294 \ub370\uc774\ud130\uc14b\uc744 \ubc18\ubcf5\ubb38\uc744 \ud1b5\ud574 \uc0ac\uc6a9\ud574\ubcf4\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4. \uc774\uc81c \uc774 \ubaa8\ub4e0\uac83\uc744 \ub2e4 \uaebc\ub0b4\uc5b4\uc11c \ubcc0\ud658\uc744 \uad6c\uc131\ud558\uace0 \ub370\uc774\ud130\uc14b\uc744 \ub9cc\ub4e4\uc5b4\ubd05\uc2dc\ub2e4. \uc694\uc57d\ud558\uc790\uba74 \ud56d\uc0c1 \uc774 \ub370\uc774\ud130\uc14b\uc744 \ub2e4\uc74c\uacfc \uac19\uc774 \ubd88\ub7ec\uc640\uc9d1\ub2c8\ub2e4. \uc774\ubbf8\uc9c0\ub294 \uc77d\uc73c\ub824\uace0 \ud560\ub54c\ub9c8\ub2e4 \ubd88\ub7ec\uc635\ub2c8\ub2e4. \ubcc0\ud615\ub4e4\uc740 \uc77d\uc740 \uc774\ubbf8\uc9c0\uc5d0 \uc801\uc6a9\uc774 \ub429\ub2c8\ub2e4. \ubcc0\ud615\ub4e4\uc911 \ud558\ub098\ub294 \ubb34\uc791\uc704\ub97c \uc774\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0, \ub370\uc774\ud130\ub294 \uc0d8\ud50c\ub9c1\uc5d0 \ub530\ub77c \uc99d\uac15\ub429\ub2c8\ub2e4. \uc800\ubc88\uc5d0 \ud574\ubcf8\uac83\ucc98\ub7fc \uc0dd\uc131\ub41c \ub370\uc774\ud130\uc14b\uc744 for i in range \uc774\ub77c\ub294 \ubc18\ubcf5\ubb38\uc744 \ud1b5\ud574 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. transformed_dataset = FaceLandmarksDataset(csv_file=\u0027faces/face_landmarks.csv\u0027, root_dir=\u0027faces/\u0027, transform=transforms.Compose([ Rescale(256), RandomCrop(224), ToTensor() ])) for i in range(len(transformed_dataset)): sample = transformed_dataset[i] print(i, sample[\u0027image\u0027].size(), sample[\u0027landmarks\u0027].size()) if i == 3: break \uc138\ubc88\uc9f8: Dataloader# \uc9c1\uc811\uc801\uc73c\ub85c \ub370\uc774\ud130\uc14b\uc744 for \ubc18\ubcf5\ubb38\uc73c\ub85c \ub370\uc774\ud130\ub97c \uc774\uc6a9\ud558\ub294\uac74 \ub9ce\uc740 \ud2b9\uc131\ub4e4\uc744 \ub193\uce60 \uc218 \ubc16\uc5d0 \uc5c6\uc2b5\ub2c8\ub2e4. \ud2b9\ud788, \uc6b0\ub9ac\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \ud2b9\uc131\ub4e4\uc744 \ub193\uce5c\ub2e4\uace0 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub370\uc774\ud130 \ubc30\uce58 \ub370\uc774\ud130 \uc11e\uae30 multiprocessing \ub97c \uc774\uc6a9\ud558\uc5ec \ubcd1\ub82c\uc801\uc73c\ub85c \ub370\uc774\ud130 \ubd88\ub7ec\uc624\uae30 torch.utils.data.DataLoader \ub294 \ubc18\ubcf5\uc790\ub85c\uc11c \uc704\uc5d0 \ub098\uc640\uc788\ub294 \ubaa8\ub4e0 \ud2b9\uc131\ub4e4\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc544\ub798\uc5d0 \uc81c\uc2dc\ub41c \uc0ac\uc6a9\ub418\ub294 \ub9e4\uac1c\ubcc0\uc218\ub4e4\uc740 \uc27d\uac8c \uc774\ud574\uac00 \ub420\uac81\ub2c8\ub2e4. \ud765\ubbf8\ub85c\uc6b4 \ubc30\uac1c\ubcc0\uc218\ub294 collate_fn \uc778\ub370 \uc774\uac83\uc740 \uc815\ud655\ud558\uac8c collate_fn \uc744 \ud1b5\ud574 \uba87\uac1c\uc758 \uc0d8\ud50c\ub4e4\uc774 \ubc30\uce58\uac00 \ub418\uc5b4\uc57c\ud558\ub294\uc9c0 \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uad73\uc774 \uc218\uc815\ud558\uc9c0 \uc54a\uc544\ub3c4 \ub300\ubd80\ubd84\uc758 \uacbd\uc6b0\uc5d0\ub294 \uc798 \uc791\ub3d9\ud560\uac81\ub2c8\ub2e4. dataloader = DataLoader(transformed_dataset, batch_size=4, shuffle=True, num_workers=4) # \ubc30\uce58\ub97c \ubcf4\uc5ec\uc8fc\uae30\uc704\ud55c \ub3c4\uc6c0 \ud568\uc218 def show_landmarks_batch(sample_batched): \"\"\" \uc0d8\ud50c\ub4e4\uc758 \ubc30\uce58\uc5d0\uc11c \uc774\ubbf8\uc9c0\uc640 \ud568\uaed8 \ub79c\ub4dc\ub9c8\ud06c\ub97c \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. \"\"\" images_batch, landmarks_batch = \\ sample_batched[\u0027image\u0027], sample_batched[\u0027landmarks\u0027] batch_size = len(images_batch) im_size = images_batch.size(2) grid = utils.make_grid(images_batch) plt.imshow(grid.numpy().transpose((1, 2, 0))) for i in range(batch_size): plt.scatter(landmarks_batch[i, :, 0].numpy() + i * im_size, landmarks_batch[i, :, 1].numpy(), s=10, marker=\u0027.\u0027, c=\u0027r\u0027) plt.title(\u0027Batch from dataloader\u0027) for i_batch, sample_batched in enumerate(dataloader): print(i_batch, sample_batched[\u0027image\u0027].size(), sample_batched[\u0027landmarks\u0027].size()) # 4\ubc88\uc9f8 \ubc30\uce58\ub97c \ubcf4\uc5ec\uc8fc\uace0 \ubc18\ubcf5\ubb38\uc744 \uba48\ucda5\ub2c8\ub2e4. if i_batch == 3: plt.figure() show_landmarks_batch(sample_batched) plt.axis(\u0027off\u0027) plt.ioff() plt.show() break \uc774\uc81c PyTorch\ub97c \uc774\uc6a9\ud574\uc11c \uc5b4\ub5bb\uac8c \uc0ac\uc6a9\uc790 \uc815\uc758 dataloader\ub97c \ub9cc\ub4dc\ub294\uc9c0 \ubc30\uc6e0\uc2b5\ub2c8\ub2e4. \uc800\ud76c\ub294 \uc880 \ub354 \uad00\ub828\ub41c \ubb38\uc11c\ub4e4\uc744 \uae4a\uac8c \uc77d\uc73c\uc154\uc11c \ub354\uc6b1 \ub9de\ucda4\ud654\ub41c \uc791\uc5c5 \ud750\ub9bc\uc744 \uac00\uc9c0\uae38 \ucd94\ucc9c \ub4dc\ub9bd\ub2c8\ub2e4. \ub354 \ubc30\uc6cc\ubcf4\uc2dc\ub824\uba74 torch.utils.data \ubb38\uc11c\ub97c \uc5ec\uae30 \uc5d0\uc11c \uc77d\uc5b4 \ubcf4\uc2e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Total running time of the script: (0 minutes 0.379 seconds) Download Jupyter notebook: custom_dataset_transforms_loader.ipynb Download Python source code: custom_dataset_transforms_loader.py Download zipped: custom_dataset_transforms_loader.zip",
       "author": {
         "@type": "Organization",
         "name": "PyTorch Contributors",
         "url": "https://pytorch.org"
       },
       "image": "../../_static/img/pytorch_seo.png",
       "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "/recipes/recipes/custom_dataset_transforms_loader.html"
       },
       "datePublished": "2023-01-01T00:00:00Z",
       "dateModified": "2023-01-01T00:00:00Z"
     }
 </script>
  <script>
    // Tutorials Call to action event tracking
    $("[data-behavior='call-to-action-event']").on('click', function () {
      fbq('trackCustom', "Download", {
        tutorialTitle: $('h1:first').text(),
        downloadLink: this.href,
        tutorialLink: window.location.href,
        downloadTitle: $(this).attr("data-response")
      });
      if (typeof gtag === 'function') {
        gtag('event', 'click', {
          'event_category': $(this).attr("data-response"),
          'event_label': $("h1").first().text(),
          'tutorial_link': window.location.href
        });
      }
    });
  </script>
  
  </body>
</html>